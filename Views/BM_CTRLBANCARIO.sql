USE [DATACLASSIC]
GO

/****** Object:  View [dbo].[BM_CTRLBANCARIO]    Script Date: 05/03/2024 08:41:18 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



CREATE VIEW [dbo].[BM_CTRLBANCARIO]
AS

SELECT dbo.TB04009.TB04009_CODEMP AS Codemp,
	   TB01007_NOME Empresa,
	   TB04008_CODIGO Codban,
	   TB04008_NOME Banco,
	   dbo.TB04009.TB04009_CODIGO AS CodConta,
	   dbo.TB04009.TB04009_NOME AS Conta,
	   
	   CASE WHEN 

	   (SELECT SUM(TB04018_A.TB04018_VALOR)
	      FROM dbo.TB04018 AS TB04018_A
	     WHERE TB04018_A.TB04018_CODCADBANCO = dbo.TB04009.TB04009_CODIGO
		   AND TB04018_A.TB04018_TIPO = 'C'
		   AND TB04018_A.TB04018_COMPENSADO = 'S') -
	  
	   (SELECT SUM(TB04018_C.TB04018_VALOR)
	      FROM dbo.TB04018 AS TB04018_C
	     WHERE TB04018_C.TB04018_CODCADBANCO = dbo.TB04009.TB04009_CODIGO
		   AND TB04018_C.TB04018_TIPO = 'D'
		   AND TB04018_C.TB04018_COMPENSADO = 'S') IS NULL THEN    	  
	  
	   (SELECT SUM(TB04018_C.TB04018_VALOR)
	      FROM dbo.TB04018 AS TB04018_C
	     WHERE TB04018_C.TB04018_CODCADBANCO = dbo.TB04009.TB04009_CODIGO
		   AND TB04018_C.TB04018_HISTORICO = 'SALDO INICIAL'
		   AND TB04018_C.TB04018_COMPENSADO = 'S') ELSE

	   (SELECT SUM(TB04018_A.TB04018_VALOR)
	      FROM dbo.TB04018 AS TB04018_A
	     WHERE TB04018_A.TB04018_CODCADBANCO = dbo.TB04009.TB04009_CODIGO
		   AND TB04018_A.TB04018_TIPO = 'C'
		   AND TB04018_A.TB04018_COMPENSADO = 'S') -
	  
	   (SELECT SUM(TB04018_C.TB04018_VALOR)
	      FROM dbo.TB04018 AS TB04018_C
	     WHERE TB04018_C.TB04018_CODCADBANCO = dbo.TB04009.TB04009_CODIGO
		   AND TB04018_C.TB04018_TIPO = 'D'
		   AND TB04018_C.TB04018_COMPENSADO = 'S') END 

	  
AS Inicial,

							   CASE WHEN TB04008_CODIGO = '033' THEN 'https://i.ibb.co/w6y2qBr/santander-logo-2.png'
									WHEN TB04008_CODIGO = '341' THEN 'https://i.ibb.co/gt2BH8f/ITAU.png'
									WHEN TB04008_CODIGO = '001' THEN 'https://i.ibb.co/dtzHhTD/bb-bancobrasil.png'
									WHEN TB04008_CODIGO = '999' THEN 'https://i.ibb.co/6HbLVk2/wallet.png'
									WHEN TB04008_CODIGO = '399' THEN 'https://i.ibb.co/wQbtPFZ/hsbc-274185.png'
									WHEN TB04008_CODIGO = '237' THEN 'https://i.ibb.co/NNxzYXL/bradesco-minor.png'
									WHEN TB04008_CODIGO = '104' THEN 'https://i.ibb.co/n3gG8Bv/caixa2.png'
									WHEN TB04008_CODIGO = '077' THEN 'https://i.ibb.co/xgM2LdB/banco-inter-logo.png'
									WHEN TB04008_CODIGO = '422' THEN 'https://i.ibb.co/PmRV3Jb/SAFRA.png'
									WHEN TB04008_CODIGO = '756' THEN 'https://i.ibb.co/prSzVmS/sicoob-logo-1.png'
									ELSE 'https://i.ibb.co/6HbLVk2/wallet.png'
									END ImgBanco

FROM TB04009
LEFT JOIN TB04008 ON TB04008_CODIGO = TB04009_BANCO
LEFT JOIN TB01007 ON TB01007_CODIGO = TB04009_CODEMP
                        
WHERE        (dbo.TB04009.TB04009_SITUACAO = 'A')
  AND TB04009_ANALISECAIXA = 'N'




GO

