USE [DATACLASSIC]
GO

/****** Object:  View [dbo].[BM_0004_2]    Script Date: 05/03/2024 08:33:26 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




CREATE VIEW [dbo].[BM_0004_2]
AS

/* Informações do contrato, faturamento e leituras */
SELECT TB02111_CODIGO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   EMP1.TB01007_NOME EmpEstoque,
	   EMP2.TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,	   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02111_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
       TB01008_NOME + ' - ' +  TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,      
       TB02111_CODEMP Empresa,
       SUBSTRING(TB02127_MES, 4, 4) + '-' + SUBSTRING(TB02127_MES, 1, 2) + '-01 00:00:00' DataMês,
	   TB02127_MES Mês,
	   TB02127_NUMSERIE Série,
	   TB02112_PAT Pat,
	   CASE WHEN TB02112_CUSTO = 0 THEN TB01010_CUSTOU ELSE TB02112_CUSTO END CustoSerie0,
	   
	   CASE WHEN EXISTS (SELECT * FROM BM_VENCCONTR WHERE BM_VENCCONTR.Contrato = TB02126_CONTRATO AND BM_VENCCONTR.mes = TB02126_MES) THEN
				 CASE WHEN TB02112_CUSTO = 0 THEN TB01010_CUSTOU ELSE TB02112_CUSTO END / 48 ELSE 0 END CustoSerie,
 
	   TB01010_NOME Equipamento,
	   TB02176_NOME Site,
	   TB02177_NOME Departamento,	   
       0 ProdPB,
       0 ProdCOR,
       0 ProdDG,
       0 ProdA3PB,
       0 ProdA3COR, 
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   TB02127_VLRCONTR ValorFixo,
       TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB ValorPB,
       TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR ValorCOR, 
       TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG ValorDG,
       TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF ValorA3PB, 
       TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC ValorA3COR,
       TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC ValorTotalFat,
	   (SELECT SUM(TB02127_VLRCONTR)+
			   SUM(TB02127_VLRTIRADASPB)+
			   SUM(TB02127_VLREXCEDPB)+
			   SUM(TB02127_VLRTIRADASCOR)+
			   SUM(TB02127_VLREXCEDCOR)+
			   SUM(TB02127_VLRTIRADASDG)+
			   SUM(TB02127_VLREXCEDDG)+
			   SUM(TB02127_VLRTIRADASGF)+
			   SUM(TB02127_VLREXCEDGF)+
			   SUM(TB02127_VLRTIRADASGFC)+
			   SUM(TB02127_VLREXCEDGFC) 	 
	   FROM TB02127
	   LEFT JOIN TB02111 ON TB02111_CODIGO = TB02127_CONTRATO
	   WHERE TB02111_CODSUB NOT IN ('0093')) SomaFatTotal,
	   0 ValorTotalSup,
	   0 QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   NULL Item,
	   NULL RefItem,
	   NULL ValorItem,
       TB01006_NOME Vendedor,
       TB02111_VLRCONTRATA ValorEstimado,
	   TB02111_QTDECONTRATA QtdeContratada,
	   1 QtdeContratadaCALC,
	   TB02111_QTDE QtdeAtual,
	   '(Faturamento e Leitura)' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Fechamentos e produções' Tipo,
	   TB01010_CUSTO Custo,

	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((SELECT TB01005_ALIQPIS FROM TB01005 WHERE TB01005_CODIGO = '0004')/100) AS NUMERIC(11,2)) ValorPIS,

	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((SELECT TB01005_ALIQCOFINS FROM TB01005 WHERE TB01005_CODIGO = '0004')/100) AS NUMERIC(11,2)) ValorCofins,

	  CASE WHEN TB02111_RETIR = 'S' 
	       THEN CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((SELECT TB01005_ALIQIR FROM TB01005 WHERE TB01005_CODIGO = '0004')/100) AS NUMERIC(11,2)) - 
	            CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((TB02111_ALIQIR)/100) AS NUMERIC(11,2))
		   ELSE CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((SELECT TB01005_ALIQIR FROM TB01005 WHERE TB01005_CODIGO = '0004')/100) AS NUMERIC(11,2))
	  END ValorIR, 

	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((SELECT TB01005_ALIQCSLL FROM TB01005 WHERE TB01005_CODIGO = '0004')/100) AS NUMERIC(11,2)) ValorCSLL,


	  CASE WHEN TB02126_CODVENDA IS NOT NULL THEN
	  (SELECT TB02021_VLRPIS
	    FROM TB02021
	   WHERE TB02021_CODIGO = TB02126_CODVENDA
	     AND TB02021_CODCLI = TB02126_CODCLI)
	  ELSE
	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * (SELECT TB00040_PIS / 100 FROM TB00040) as numeric(11,2)) END +
	  CASE WHEN TB02126_CODVENDA IS NOT NULL THEN
	  (SELECT TB02021_VLRCOFINS
	    FROM TB02021
	   WHERE TB02021_CODIGO = TB02126_CODVENDA
	     AND TB02021_CODCLI = TB02126_CODCLI)
	  ELSE
	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * (SELECT TB00040_COFINS / 100 FROM TB00040) as numeric(11,2)) END +

	  CASE WHEN TB02126_CODVENDA IS NOT NULL THEN
	  (SELECT TB02021_VLRIR
	    FROM TB02021
	   WHERE TB02021_CODIGO = TB02126_CODVENDA
	     AND TB02021_CODCLI = TB02126_CODCLI)
	  ELSE
	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * (SELECT TB00040_IRREC / 100 FROM TB00040) as numeric(11,2)) END +
	  	  CASE WHEN TB02126_CODVENDA IS NOT NULL THEN
	  (SELECT TB02021_VLRCSLL
	    FROM TB02021
	   WHERE TB02021_CODIGO = TB02126_CODVENDA
	     AND TB02021_CODCLI = TB02126_CODCLI)
	  ELSE
	  CAST((TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * (SELECT TB00040_CSLLREC / 100 FROM TB00040) as numeric(11,2)) END ValorImpostosDB,
	 (SELECT TB02021_NTSERV
	    FROM TB02021
	   WHERE TB02021_CODIGO = TB02126_CODVENDA
	     AND TB02021_CODCLI = TB02126_CODCLI) NotaServico,

	 CASE WHEN TB02111_RETISS = 'S' THEN 0.00
		  ELSE CAST(( TB02127_VLRCONTR + TB02127_VLRTIRADASPB + TB02127_VLREXCEDPB + TB02127_VLRTIRADASCOR + TB02127_VLREXCEDCOR + TB02127_VLRTIRADASDG + TB02127_VLREXCEDDG + TB02127_VLRTIRADASGF + TB02127_VLREXCEDGF + TB02127_VLRTIRADASGFC + TB02127_VLREXCEDGFC) * ((SELECT TB01005_ALIQISS FROM TB01005 WHERE TB01005_CODIGO = '0004')/100) AS NUMERIC(11,2)) 
	 END ValorISS,

	  TB02126_RECIBO Recibo,
	 (SELECT SUM(TB04010_VLRPAGO)
	    FROM TB04010
	   WHERE TB04010_CONTRATO = TB02126_CONTRATO
		 AND TB04010_MES = TB02126_MES) RecebidoRecebido,
	 (SELECT SUM(TB04010_VLRPAGO)
	    FROM TB04010
	   WHERE TB04010_CONTRATO = TB02126_CONTRATO
		 AND TB04010_MES = TB02126_MES) RecebidoPedido,
	   TB02126_VLRDESC ValorDesconto,
	   TB02126_VLRRETENCOES ValorRetenção,
	   TB02112_DATA DataInstalação,
	   TB02176_CIDADE Cidade,
	   TB02176_ESTADO Estado,
	   null Registro,
	(SELECT COUNT(TB02127_NUMSERIE)
	   FROM TB02127 AS FAT2
	  WHERE FAT2.TB02127_CONTRATO = dbo.TB02127.TB02127_CONTRATO
	    AND FAT2.TB02127_MES = dbo.TB02127.TB02127_MES) EquipamentosTeste,
	   NULL Rendimento,
	   NULL Técnico,
	   null SLA,
	   null Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   NULL VidaUtilAnterior,
	   NULL MedidorAtual,
	   NULL MedidorAnterior,
	   NULL TipoSuprimento,
	   0  ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO1.TB01107_NOME AS GrupoEco
  FROM TB02127

LEFT JOIN TB02111 ON TB02111_CODIGO = TB02127_CONTRATO
LEFT JOIN TB02126 ON TB02126_CONTRATO = TB02127_CONTRATO AND TB02126_MES = TB02127_MES
LEFT JOIN TB02112 ON TB02112_CODIGO = TB02127_CONTRATO AND TB02112_PRODUTO = TB02127_PRODUTO AND TB02112_NUMSERIE = TB02127_NUMSERIE
LEFT JOIN TB01007 AS EMP1 ON EMP1.TB01007_CODIGO = TB02111_CODEMP
LEFT JOIN TB01007 AS EMP2 ON EMP2.TB01007_CODIGO = TB02111_CODEMP2
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02111_CODCLI
LEFT JOIN TB01107 AS GRUPO1 ON GRUPO1.TB01107_CODIGO = TB01008_GRUPO
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02111_VEND
LEFT JOIN TB01010 ON TB01010_CODIGO = TB02112_PRODUTO
LEFT JOIN TB02176 ON TB02176_CODIGO = TB02112_CODSITE
LEFT JOIN TB02177 ON TB02177_CODIGO = TB02112_CODDEPTO

UNION

SELECT TB02111_CODIGO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   EMP1.TB01007_NOME EmpEstoque,
	   EMP2.TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,	   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   NULL Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02111_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
       TB01008_NOME + ' - ' +  TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,   
       TB02111_CODEMP Empresa,
       TB02118_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10), TB02118_DATA, 103), 4, 7) Mês,
	   NULL Série,
	   NULL Pat,
	   NULL CustoSerie0,
	   NULL CustoSerie,
	   NULL Equipamento,
	   NULL Site,
	   NULL Departamento,
       NULL ProdPB,
       NULL ProdCOR,
       NULL ProdDG,
       NULL ProdA3PB,
       NULL ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
       0 ValorPB,
       0 ValorCOR, 
       0 ValorDG,
       0 ValorA3PB, 
       0 ValorA3COR,
       TB02118_VLRNOTA ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   0 QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   NULL Item,
	   NULL RefItem,
	   NULL ValorItem,
       TB01006_NOME Vendedor,
       TB02111_VLRCONTRATA ValorEstimado,
	   TB02111_QTDECONTRATA QtdeContratada,
	   1 QtdeContratadaCALC,
	   TB02111_QTDE QtdeAtual,
	   '(Faturamento e Leitura)' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Fechamentos e produções' Tipo,
	   0 Custo,
	   0 ValorPIS,
	   0 ValorCofins,
	   0 ValorIR,
	   0 ValorCSLL,
	   0 ValorImpostosDB,
	   NULL NotaServico,
	   0 ValorISS,
	   TB02118_CODIGO Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   TB02118_VLRDESCONTO ValorDesconto,
	   CAST(TB02118_VLRRETCOFINS + TB02118_VLRRETCSLL + TB02118_VLRRETIR + TB02118_VLRRETPIS as numeric(11,2)) ValorRetenção,
	   NULL DataInstalação,
	   NULL Cidade,
	   NULL Estado,
	   NULL Registro,
	 (SELECT COUNT(TB02117_NUMSERIE)
	    FROM TB02117 AS FAT2
	   WHERE TB02118_CONTRATO = FAT2.TB02117_CODIGO
	     AND TB02118_MES = SUBSTRING(CONVERT(VARCHAR(10), FAT2.TB02117_DATA, 103), 4, 7)) EquipamentosTeste,   
	   NULL Rendimento,
	   NULL Técnico,
	   NULL SLA,
	   NULL Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   NULL VidaUtilAnterior,
	   NULL MedidorAtual,
	   NULL MedidorAnterior,
	   NULL TipoSuprimento,
	   0  ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO2.TB01107_NOME AS GrupoEco
  FROM TB02118
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02118_CONTRATO AND TB02111_CODCLI = TB02118_CODCLI
LEFT JOIN TB01007 AS EMP1 ON EMP1.TB01007_CODIGO = TB02111_CODEMP
LEFT JOIN TB01007 AS EMP2 ON EMP2.TB01007_CODIGO = TB02111_CODEMP2
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02111_CODCLI
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02111_VEND
LEFT JOIN TB01107 AS GRUPO2 ON GRUPO2.TB01107_CODIGO = TB01008_GRUPO
WHERE TB02118_CODIGO NOT IN (SELECT TB02126_RECIBO FROM TB02126 WHERE TB02126_RECIBO IS NOT NULL)

UNION

SELECT TB04010_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   dbo.TB01007.TB01007_NOME EmpEstoque,
	   dbo.TB01007.TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   NULL Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02111_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
       VW04004.TB01008_NOME + ' - ' + VW04004.TB04010_CONTRATO Cliente,
	   VW04004.TB01008_NOME Cliente2,
       (SELECT TB02111_NOME FROM TB02111 WHERE TB02111_CODIGO = VW04004.TB04010_CONTRATO) Fantasia,   
       TB02111_CODEMP Empresa,
       SUBSTRING(TB04010_MES, 4, 4) + '-' + SUBSTRING(TB04010_MES, 1, 2) + '-01 00:00:00' DataMês,
	   TB04010_MES Mês,
	   NULL Série,
	   NULL Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   NULL Equipamento,
	   NULL Site,
	   NULL Departamento,
       0 ProdPB,
       0 ProdCOR,
       0 ProdDG,
       0 ProdA3PB,
       0 ProdA3COR, 
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
       0 ValorPB,
       0 ValorCOR, 
       0 ValorDG,
       0 ValorA3PB, 
       0 ValorA3COR,
       0 ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   0 QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   NULL Item,
	   NULL RefItem,
	   NULL ValorItem,
       TB01006_NOME Vendedor,
       TB02111_VLRCONTRATA ValorEstimado,
	   TB02111_QTDECONTRATA QtdeContratada,
	   1 QtdeContratadaCALC,
	   TB02111_QTDE QtdeAtual,
	   '(Faturamento e Leitura) - Recebimento' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Fechamentos e produções - Recebimento' Tipo,
	   0 Custo,
	   0 ValorPIS,
	   0 ValorCofins,
	   0 ValorIR,
	   0 ValorCSLL,
	   0 ValorImpostosDB,
	   TB04010_NTFISC NotaServico,
	   0 ValorISS,
	   TB04010_NTFISC Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   NULL DataInstalação,
	   NULL Cidade,
	   NULL Estado,
	   NULL Registro,
	   NULL EquipamentosTeste,
	   NULL Rendimento,
	   NULL Técnico,
	   NULL SLA,
	   NULL Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   NULL VidaUtilAnterior,
	   NULL MedidorAtual,
	   NULL MedidorAnterior,
	   NULL TipoSuprimento,
	   0  ValorFreteReq,
	   0 ValorServicos,
	   SUM(TB04010_VLRPAGO) Receita,
	   VW04004.TB01107_NOME GrupoEco
  FROM VW04004
LEFT JOIN TB02111 ON TB02111_CODIGO = VW04004.TB04010_CONTRATO
LEFT JOIN TB01007 ON TB01007_CODIGO = TB02111_CODEMP
 WHERE EXISTS (SELECT * FROM TB02111 WHERE TB02111_CODIGO = VW04004.TB04010_CONTRATO)
GROUP BY VW04004.TB04010_CONTRATO, TB02111_SITUACAO, dbo.TB01007.TB01007_NOME, TB02111_TIPOCONTR, TB02111_FRANQPB, TB02111_FRANQCOLOR, TB02111_FRANQGF,
	     TB02111_ANALFRANQUIA, TB02111_PAPEL, TB02111_PARTICULAR, TB02111_ATA, TB02111_DTINICIO, TB02111_VENCCONTR, TB02111_DTREAJUSTE,
		 TB02111_DTULTAJUSTE, TB02111_DURACAO, TB02111_CODCLI, TB02111_CODIGO, VW04004.TB01008_NOME, TB02111_NOME, TB02111_CODEMP, TB04010_MES,
		 VW04004.TB01006_NOME, TB02111_VLRCONTRATA, TB02111_QTDECONTRATA, TB02111_QTDE, vw04004.TB04010_NTFISC, TB01107_NOME, TB02111.TB02111_CODSUB

UNION

SELECT TB02111_CODIGO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   EMP1.TB01007_NOME EmpEstoque,
	   EMP2.TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,
	  TB02111_PAPEL DireitoPapel,
	  TB02111_PARTICULAR Particular,
	  TB02111_ATA Ata,
	  CAST(TB02111_OBS as varchar(max)) Observações,
	  TB02111_DTINICIO DataInício,
	  TB02111_VENCCONTR Vencimento,
	  TB02111_DTREAJUSTE Reajuste,
	  TB02111_DTULTAJUSTE UltReajuste,
	  TB02111_DURACAO Duração,
	  TB02111_CODCLI CodCli,
	  TB02111.TB02111_CODSUB Subcentro,
      TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	  TB01008_NOME Cliente2,
      TB02111_NOME Fantasia,
      TB02111_CODEMP Empresa,
      TB02117_DATA DataMês,
	  SUBSTRING(CONVERT(VARCHAR(10),TB02117_DATA, 103), 4, 7) Mês,
	  TB02117_NUMSERIE Série,
	  TB02112_PAT Pat,
	  ISNULL(TB02112_CUSTO, 0) CustoSerie0,
	  0 CustoSerie,
	  TB01010_NOME Equipamento,
	  TB02176_NOME [Site],
	  TB02177_NOME Departamento,
      TB02117_TOTPB ProdPB,
      TB02117_TOTCOLOR ProdCOR,
      TB02117_TOTDG ProdDG,
      TB02117_TOTGF ProdA3PB,
      TB02117_TOTGFC ProdA3COR,
	  0 PAP_ProdPB,
	  0 PAP_ProdCOR,
	  0 PAP_ProdDG,
	  0 PAP_ProdA3PB,
	  0 PAP_ProdA3COR,
	  0 ValorFixo,
      0 ValorPB,
      0 ValorCOR, 
      0 ValorDG,
      0 ValorA3PB, 
      0 ValorA3COR,
      0 ValorTotalFat,
	  0 SomaFatTotal,
	  0 ValorTotalSup,
	  0 QtdeProdSup,
	  0 ValorTotalPapel,
	  0 QtdeProdPapel,
	  NULL OS,
	  NULL Item,
	  NULL RefItem,
	  NULL ValorItem,
      TB01006_NOME Vendedor,
      TB02111_VLRCONTRATA ValorEstimado,
	  TB02111_QTDECONTRATA QtdeContratada,
	  1 QtdeContratadaCALC,
	  TB02111_QTDE QtdeAtual,
	  'Leitura' Grupo,
	  NULL Subgrupo,
	  NULL Marca,
	  'Produções' Tipo,
	  TB01010_CUSTO Custo,
	  0 ValorPIS,
	  0 ValorCofins,
	  0 ValorIR,
	  0 ValorCSLL,
	  NULL ValorImpostosDB,
	  NULL NotaServico,
	  NULL ValorISS,
	  NULL Recibo,
	  0 RecebidoRecebido,
	  NULL RecebidoPedido,
	  0 ValorDesconto,
	  0 ValorRetenção,
	  TB02112_DATA DataInstalação,
	  TB02176_CIDADE Cidade,
	  TB02176_ESTADO Estado,
	  NULL Registro,
	(SELECT COUNT(TB02117_NUMSERIE)
	   FROM TB02117 AS FAT2
	  WHERE FAT2.TB02117_CODIGO = dbo.TB02117.TB02117_CODIGO
	    AND FAT2.TB02117_DATA = dbo.TB02117.TB02117_DATA) EquipamentosTeste,
	  NULL Rendimento,
	  NULL Técnico,
	  NULL SLA,
	  NULL Reincidência,
	  NULL DataIni,
	  NULL HoraIni,
	  NULL DataFim,
	  NULL HoraFim,
	  0 CustoPeca,
	  NULL ReqAnterior,
	  NULL VidaUtilAnterior,
	  NULL MedidorAtual,
	  NULL MedidorAnterior,
	  NULL TipoSuprimento,
	  0  ValorFreteReq,
	  0 ValorServicos,
	  0 Receita,
	  GRUPO3.TB01107_NOME AS GrupoEco
 FROM TB02117
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02117_CODIGO
LEFT JOIN TB02112 ON TB02112_CODIGO = TB02117_CODIGO AND TB02112_PRODUTO = TB02117_PRODUTO AND TB02112_NUMSERIE = TB02117_NUMSERIE
LEFT JOIN TB01007 AS EMP1 ON EMP1.TB01007_CODIGO = TB02111_CODEMP
LEFT JOIN TB01007 AS EMP2 ON EMP2.TB01007_CODIGO = TB02111_CODEMP2
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02111_CODCLI
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02111_VEND
LEFT JOIN TB01010 ON TB01010_CODIGO = TB02112_PRODUTO
LEFT JOIN TB02176 ON TB02176_CODIGO = TB02112_CODSITE
LEFT JOIN TB02177 ON TB02177_CODIGO = TB02112_CODDEPTO
LEFT JOIN TB01107 AS GRUPO3 ON GRUPO3.TB01107_CODIGO = TB01008_GRUPO

UNION

SELECT TB02021_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   TB01007_NOME EmpEstoque,
	   TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02021_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
       TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,    
       TB02111_CODEMP Empresa,
	   TB02021_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10),TB02021_DATA, 103), 4, 7) Mês,
	   TB02021_NUMSERIE Série,
	   TB02112_PAT Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   dbo.TB01010.TB01010_NOME Equipamento,
	   TB02176_NOME Site,
	   TB02177_NOME Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   TB02022_TOTVALOR ValorTotalSup,
	   TB02022_QTPROD QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   SUP.TB01010_NOME Item,
	   SUP.TB01010_REFERENCIA RefItem,
	   NULL ValorItem,
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   TB01002_NOME Grupo,
	   TB01018_NOME Subgrupo,
	   TB01047_NOME Marca,
	   'Consumo' Tipo,
	   dbo.TB01010.TB01010_CUSTO Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,
	   NULL NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   TB02112_DATA DataInstalação,
	   TB02176_CIDADE Cidade,
	   TB02176_ESTADO Estado,
	   TB02021_CODIGO Registro,
	   null EquipamentosTeste,
	   SUP.TB01010_COPIA Rendimento,
	   NULL Técnico,
	   null SLA,
	   null Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,  
	   NULL ReqAnterior,
       0 VidaUtilAnterior,
	   TB02021_CONTTOTAL MedidorAtual,
	   0 MedidorAnterior,
	   CASE WHEN SUP.TB01010_GRUPO IN ('0003', '0006') THEN 'Toner' ELSE 'Outros' END TipoSuprimento,
	   TB02021_VLRFRETE ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO4.TB01107_NOME GrupoEco
  FROM TB02022
LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO AND TB02021_CODEMP = TB02022_CODEMP AND TB02021_CODCAI = TB02022_CODCAI
LEFT JOIN TB01007 ON TB01007_CODIGO = TB02021_CODEMP
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02021_CONTRATO
LEFT JOIN TB02112 ON TB02112_CODIGO = TB02021_CONTRATO AND TB02112_NUMSERIE = TB02021_NUMSERIE
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02021_VEND
LEFT JOIN TB01010 ON TB01010_CODIGO = TB02112_PRODUTO
LEFT JOIN TB01010 AS SUP ON SUP.TB01010_CODIGO = TB02022_PRODUTO
LEFT JOIN TB01002 ON TB01002_CODIGO = SUP.TB01010_GRUPO
LEFT JOIN TB01018 ON TB01018_CODIGO = SUP.TB01010_SUBGRUPO
LEFT JOIN TB01047 ON TB01047_CODIGO = SUP.TB01010_MARCA
LEFT JOIN TB02176 ON TB02176_CODIGO = TB02112_CODSITE
LEFT JOIN TB02177 ON TB02177_CODIGO = TB02112_CODDEPTO
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02021_CODCLI
LEFT JOIN TB01107 AS GRUPO4 ON GRUPO4.TB01107_CODIGO = TB01008_GRUPO
 WHERE TB02021_BONIF = 'S'
   AND TB02021_CONTRATO IS NOT NULL AND TB02021_CONTRATO <> ''
   AND TB02021_NUMSERIE IS NOT NULL
   AND TB02021_TIPODESC IN (SELECT TB01022_CODIGO FROM TB01022 WHERE TB01022_TIPOOPER = 'L')
   AND NOT EXISTS (SELECT * FROM TB02012 LEFT JOIN TB02011 ON TB02011_CODIGO = TB02012_CODIGO WHERE TB02011_NUMVEN = TB02021_CODIGO AND TB02022_PRODUTO = TB02012_PRODUTO AND TB02011_CODEMP = TB02022_CODEMP)
   AND SUP.TB01010_SUBGRUPO <> '0031'

UNION


SELECT TB02021_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   TB01007_NOME EmpEstoque,
	   TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02021_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
       TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,    
       TB02111_CODEMP Empresa,
	   TB02021_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10),TB02021_DATA, 103), 4, 7) Mês,
	   ISNULL(TB02021_NUMSERIE, 'Remessa de Papel') Série,
	   TB02112_PAT Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   ISNULL(dbo.TB01010.TB01010_NOME, 'Remessa de Papel') Equipamento,
	   TB02176_NOME Site,
	   TB02177_NOME Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   TB02022_TOTVALOR ValorTotalSup,
	   TB02022_QTPROD QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   SUP.TB01010_NOME Item,
	   SUP.TB01010_REFERENCIA RefItem,
	   NULL ValorItem,
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   TB01002_NOME Grupo,
	   TB01018_NOME Subgrupo,
	   TB01047_NOME Marca,
	   'Consumo Papel' Tipo,
	   dbo.TB01010.TB01010_CUSTO Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,
	   NULL NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   TB02112_DATA DataInstalação,
	   TB02176_CIDADE Cidade,
	   TB02176_ESTADO Estado,
	   TB02021_CODIGO Registro,
	   null EquipamentosTeste,
	   SUP.TB01010_COPIA Rendimento,
	   NULL Técnico,
	   null SLA,
	   null Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,  
	   NULL ReqAnterior,
       0 VidaUtilAnterior,
	   TB02021_CONTTOTAL MedidorAtual,
	   0 MedidorAnterior,
       'Papel' TipoSuprimento,
	   TB02021_VLRFRETE ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO4.TB01107_NOME GrupoEco
  FROM TB02022
LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO AND TB02021_CODEMP = TB02022_CODEMP AND TB02021_CODCAI = TB02022_CODCAI
LEFT JOIN TB01007 ON TB01007_CODIGO = TB02021_CODEMP
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02021_CONTRATO
LEFT JOIN TB02112 ON TB02112_CODIGO = TB02021_CONTRATO AND TB02112_NUMSERIE = TB02021_NUMSERIE
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02021_VEND
LEFT JOIN TB01010 ON TB01010_CODIGO = TB02112_PRODUTO
LEFT JOIN TB01010 AS SUP ON SUP.TB01010_CODIGO = TB02022_PRODUTO
LEFT JOIN TB01002 ON TB01002_CODIGO = SUP.TB01010_GRUPO
LEFT JOIN TB01018 ON TB01018_CODIGO = SUP.TB01010_SUBGRUPO
LEFT JOIN TB01047 ON TB01047_CODIGO = SUP.TB01010_MARCA
LEFT JOIN TB02176 ON TB02176_CODIGO = TB02112_CODSITE
LEFT JOIN TB02177 ON TB02177_CODIGO = TB02112_CODDEPTO
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02021_CODCLI
LEFT JOIN TB01107 AS GRUPO4 ON GRUPO4.TB01107_CODIGO = TB01008_GRUPO
 WHERE TB02021_BONIF = 'S'
   AND TB02021_CONTRATO IS NOT NULL AND TB02021_CONTRATO <> ''
   AND TB02021_TIPODESC IN (SELECT TB01022_CODIGO FROM TB01022 WHERE TB01022_TIPOOPER = 'L')
   AND NOT EXISTS (SELECT * FROM TB02012 LEFT JOIN TB02011 ON TB02011_CODIGO = TB02012_CODIGO WHERE TB02011_NUMVEN = TB02021_CODIGO AND TB02022_PRODUTO = TB02012_PRODUTO AND TB02011_CODEMP = TB02022_CODEMP)
   AND SUP.TB01010_SUBGRUPO = '0031'

UNION

SELECT TB02115_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   TB01007_NOME EmpEstoque,
	   TB01007_NOME EmpFatura,
       CASE VW02095.TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   0 FranquiaPB,
	   0 FranquiaCor,
	   0 FranquiaA3PB,
	   0 FranquiaA3Cor,
	   NULL AnáliseFranquia,   
	   NULL DireitoPapel,
	   NULL Particular,
	   NULL Ata,
	   CAST(VW02095.TB02111_OBS as varchar(max)) Observações,
	   NULL DataInício,
	   CONTRATO.TB02111_VENCCONTR Vencimento,
	   NULL Reajuste,
	   NULL UltReajuste,
	   NULL Duração,
	   TB02115_CODCLI CodCli,
	   CONTRATO.TB02111_CODSUB Subcentro,
       VW02095.TB01008_NOME+ ' - ' + CONTRATO.TB02111_CODIGO Cliente,
	   VW02095.TB01008_NOME Cliente2,
       VW02095.TB02111_NOME Fantasia,      
       VW02095.TB02111_CODEMP Empresa,
	   TB02115_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10), TB02115_DATA, 103), 4, 7) Mês,
	   TB02115_NUMSERIE Série,
	   TB02112_PAT Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   VW02095.TB01010_NOME Equipamento,
	   TB02176_NOME Site,
	   TB02177_NOME Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   0 QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   TB02115_CODIGO OS,
	   NULL Item,
	   NULL RefItem,
	   CASE WHEN ISNULL(
	  (SELECT SUM(dbo.TB02125.TB02125_TOTVALOR)
	     FROM TB02125
		WHERE TB02125_CODIGO = VW02095.TB02122_CODIGO), 0) = 0 THEN 60.00 ELSE
		ISNULL(
	  (SELECT SUM(dbo.TB02125.TB02125_TOTVALOR)
	     FROM TB02125
		WHERE TB02125_CODIGO = VW02095.TB02122_CODIGO), 0) END ValorItem,
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   '(Assistência Técnica)' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Assistência Técnica' Tipo,
	   TB01010_1.TB01010_CUSTO Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,	   
	   NULL NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   TB02112_DATA DataInstalação,
	   NULL Cidade,
	   NULL Estado,
	   TB02115_CODIGO Registro,
	   null EquipamentosTeste,
	   NULL Rendimento,
	   TB01024_NOME Técnico,
	   CALC_RESTANTE SLA,
	   CASE WHEN TB02115_REINCIDENCIA = 'N' THEN 0 ELSE 1 END Reincidência,
	   VW02095.TB02122_DATAINI DataIni,
	   VW02095.TB02122_HORAINI HoraIni,
	   VW02095.TB02122_DATAFIM DataFim,
	   VW02095.TB02122_HORAFIM HoraFim,
	   ISNULL((SELECT SUM(TB02124_CUSTO * TB02124_QTPROD) as ValorItem FROM TB02124 WHERE TB02124_CODIGO = VW02095.TB02122_CODIGO), 0) CustoPeca,
	   NULL ReqAnterior,
	   NULL VidaUtilAnterior,
	   NULL MedidorAtual,
	   NULL MedidorAnterior,
	   NULL TipoSuprimento,
	   0  ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO6.TB01107_NOME GrupoEco
  FROM VW02095
LEFT JOIN TB02111 AS CONTRATO ON CONTRATO.TB02111_CODIGO = VW02095.TB02115_CONTRATO
LEFT JOIN TB01010 AS TB01010_1 ON TB01010_1.TB01010_CODIGO = VW02095.TB02115_PRODUTO
LEFT JOIN TB01008 AS CLI2 ON CLI2.TB01008_CODIGO = VW02095.TB02115_CODCLI
LEFT JOIN TB01107 AS GRUPO6 ON GRUPO6.TB01107_CODIGO = CLI2.TB01008_GRUPO
 WHERE TB02115_DTFECHA IS NOT NULL

/*Campos adicionais*/
UNION

SELECT TB02087_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   TB01007_NOME EmpEstoque,
	   TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   0 FranquiaPB,
	   0 FranquiaCor,
	   0 FranquiaA3PB,
	   0 FranquiaA3Cor,
	   NULL AnáliseFranquia,   
	   NULL DireitoPapel,
	   NULL Particular,
	   NULL Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   NULL DataInício,
	   TB02111_VENCCONTR Vencimento,
	   NULL Reajuste,
	   NULL UltReajuste,
	   NULL Duração,
	   TB02111_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
       TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,      
       TB02111_CODEMP Empresa,
	   TB02087_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10), TB02087_DATA, 103), 4, 7) Mês,
	   NULL Série,
	   NULL Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   NULL Equipamento,
	   NULL Site,
	   NULL Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   0 QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   NULL Item,
	   NULL RefItem,
	   0 ValorItem,				
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   'Fretes' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Con. de Transp' Tipo,
	   0 Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,
	   NULL NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   NULL DataInstalação,
	   NULL Cidade,
	   NULL Estado,
	   TB02087_CODIGO Registro,
	   NULL EquipamentosTeste,
	   NULL Rendimento,
	   NULL Técnico,
	   NULL SLA,
	   NULL Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   NULL VidaUtilAnterior,
	   NULL MedidorAtual,
	   NULL MedidorAnterior,	   
	   NULL TipoSuprimento,
	   TB02087_VLRSERV ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO7.TB01107_NOME GrupoEco
  FROM TB02087
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02087_CONTRATO
LEFT JOIN TB01007 ON TB01007_CODIGO = TB02087_CODEMP
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02111_CODCLI
LEFT JOIN TB01107 AS GRUPO7 ON GRUPO7.TB01107_CODIGO = TB01008_GRUPO
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02111_VEND
LEFT JOIN TB01009 ON TB01009_CODIGO = TB02087_TRANSP
 WHERE TB02087_CONTRATO IS NOT NULL
   AND TB02087_CONTRATO <> ''

UNION

SELECT TB02021_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   TB01007_NOME EmpEstoque,
	   TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,	   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02021_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
        TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,    
       TB02111_CODEMP Empresa,
	   TB02021_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10),TB02021_DATA, 103), 4, 7) Mês,
	   TB02021_NUMSERIE Série,
	   TB02112_PAT Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   dbo.TB01010.TB01010_NOME Equipamento,
	   TB02176_NOME Site,
	   TB02177_NOME Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   TB02022_QTPROD QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   SUP.TB01010_NOME Item,
	   SUP.TB01010_REFERENCIA RefItem,
	   NULL ValorItem,
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   'Fretes' Grupo,
	   TB01018_NOME Subgrupo,
	   TB01047_NOME Marca,
	   'Frete Requisição' Tipo,
	   dbo.TB01010.TB01010_CUSTO Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,
	   NULL NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   TB02112_DATA DataInstalação,
	   TB02176_CIDADE Cidade,
	   TB02176_ESTADO Estado,
	   TB02021_CODIGO Registro,
	   NULL EquipamentosTeste,
	   0 Rendimento,
	   NULL Técnico,
	   NULL SLA,
	   NULL Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   0 VidaUtilAnterior,
	   0 MedidorAtual,
	   0 MedidorAnterior,
	   CASE WHEN SUP.TB01010_TIPOSUP IN (1, 2, 12, 13) THEN 'Toner' ELSE 'Outros' END TipoSuprimento,
	   TB02096_VLRFRETE  ValorFreteReq,
	   0 ValorServicos,
	   0 Receita,
	   GRUPO8.TB01107_NOME GrupoEco
  FROM TB02022

LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO AND TB02021_CODEMP = TB02022_CODEMP AND TB02021_CODCAI = TB02022_CODCAI
LEFT JOIN TB01007 ON TB01007_CODIGO = TB02021_CODEMP
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02021_CONTRATO AND TB02111_CODCLI = TB02021_CODCLI
LEFT JOIN TB02112 ON TB02112_CODIGO = TB02021_CONTRATO AND TB02112_NUMSERIE = TB02021_NUMSERIE
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02021_VEND
LEFT JOIN TB01010 ON TB01010_CODIGO = TB02112_PRODUTO
LEFT JOIN TB01010 AS SUP ON SUP.TB01010_CODIGO = TB02022_PRODUTO
LEFT JOIN TB01002 ON TB01002_CODIGO = SUP.TB01010_GRUPO
LEFT JOIN TB01018 ON TB01018_CODIGO = SUP.TB01010_SUBGRUPO
LEFT JOIN TB01047 ON TB01047_CODIGO = SUP.TB01010_MARCA
LEFT JOIN TB02176 ON TB02176_CODIGO = TB02112_CODSITE
LEFT JOIN TB02177 ON TB02177_CODIGO = TB02112_CODDEPTO
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02021_CODCLI
LEFT JOIN TB02096 ON TB02096_CODIGO = TB02021_CODIGO
LEFT JOIN TB01107 AS GRUPO8 ON GRUPO8.TB01107_CODIGO = TB01008_GRUPO
 WHERE TB02021_BONIF = 'S'
   AND TB02021_CONTRATO IS NOT NULL AND TB02021_CONTRATO <> ''
   AND TB02021_NUMSERIE IS NOT NULL
   AND TB02021_TIPODESC IN (SELECT TB01022_CODIGO FROM TB01022 WHERE TB01022_TIPOOPER = 'L')

UNION

SELECT TB02088_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   TB01007_NOME EmpEstoque,
	   TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,	   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02111_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
        TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,    
       TB02111_CODEMP Empresa,
	   TB02088_DATA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10),TB02088_DATA, 103), 4, 7) Mês,
	   NULL Série,
	   NULL Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   NULL Equipamento,
	   NULL Site,
	   NULL Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   NULL QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   TB01017_NOME Item,
	   NULL RefItem,
	   NULL ValorItem,
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   'Serviços' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Lançamento de Serviços' Tipo,
	   NULL Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,
	   TB02088_NTFISC NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   NULL DataInstalação,
	   NULL Cidade,
	   NULL Estado,
	   TB02088_CODIGO Registro,
	   NULL EquipamentosTeste,
	   0 Rendimento,
	   NULL Técnico,
	   NULL SLA,
	   NULL Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   0 VidaUtilAnterior,
	   0 MedidorAtual,
	   0 MedidorAnterior,
	   NULL TipoSuprimento,
	   0 ValorFreteReq,
	   TB02088_VLRNOTA ValorServicos,
	   0 Receita,
	   GRUPO9.TB01107_NOME GrupoEco
  FROM TB02088
LEFT JOIN TB02111 ON TB02111_CODIGO = TB02088_CONTRATO
LEFT JOIN TB01007 ON TB01007_CODIGO = TB02088_CODEMP
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02111_CODCLI
LEFT JOIN TB01107 AS GRUPO9 ON GRUPO9.TB01107_CODIGO = TB01008_GRUPO
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02111_VEND
LEFT JOIN TB01017 ON TB01017_CODIGO = TB02088_PREST
 WHERE TB02088_CONTRATO IS NOT NULL
   AND TB02088_CONTRATO <> ''

UNION

SELECT TB04014_CONTRATO Contrato,
	   CASE TB02111_SITUACAO WHEN 'A' THEN 'Ativo' WHEN 'I' THEN 'Inativo' ELSE 'Suspenso' END Situação,
	   dbo.TB01007.TB01007_NOME EmpEstoque,
	   dbo.TB01007.TB01007_NOME EmpFatura,
       CASE TB02111_TIPOCONTR WHEN 'A' THEN 'Avulso' WHEN 'G' THEN 'Garantia' WHEN 'M' THEN 'Manutenção' WHEN 'L' THEN 'Locação' END TipoContrato,
	   TB02111_FRANQPB FranquiaPB,
	   TB02111_FRANQCOLOR FranquiaCor,
	   TB02111_FRANQGF FranquiaA3PB,
	   TB02111_FRANQGF FranquiaA3Cor,
	   CASE TB02111_ANALFRANQUIA
			WHEN 'T' THEN 'Por Contrato (TOTAL)'
			WHEN 'M' THEN 'Por Equipamento'
			WHEN 'G' THEN 'Por Grupo'
			WHEN 'E' THEN 'Compensatório'
			WHEN 'W' THEN 'Compensatório por Grupo' END AnáliseFranquia,	   
	   TB02111_PAPEL DireitoPapel,
	   TB02111_PARTICULAR Particular,
	   TB02111_ATA Ata,
	   CAST(TB02111_OBS as varchar(max)) Observações,
	   TB02111_DTINICIO DataInício,
	   TB02111_VENCCONTR Vencimento,
	   TB02111_DTREAJUSTE Reajuste,
	   TB02111_DTULTAJUSTE UltReajuste,
	   TB02111_DURACAO Duração,
	   TB02111_CODCLI CodCli,
	   TB02111.TB02111_CODSUB Subcentro,
        TB01008_NOME + ' - ' + TB02111_CODIGO Cliente,
	   TB01008_NOME Cliente2,
       TB02111_NOME Fantasia,    
       TB02111_CODEMP Empresa,
	   TB04015_DTBAIXA DataMês,
	   SUBSTRING(CONVERT(VARCHAR(10),TB04015_DTBAIXA, 103), 4, 7) Mês,
	   NULL Série,
	   NULL Pat,
	   0 CustoSerie0,
	   0 CustoSerie,
	   NULL Equipamento,
	   NULL Site,
	   NULL Departamento,
	   0 ProdPB,
	   0 ProdCOR,
	   0 ProdDG,
	   0 ProdA3PB,
	   0 ProdA3COR,
	   0 PAP_ProdPB,
	   0 PAP_ProdCOR,
	   0 PAP_ProdDG,
	   0 PAP_ProdA3PB,
	   0 PAP_ProdA3COR,
	   0 ValorFixo,
	   0 ValorPB,
	   0 ValorCOR,
	   0 ValorDG,
	   0 ValorA3PB,
	   0 ValorA3COR,
	   0 ValorTotalFat,
	   0 SomaFatTotal,
	   0 ValorTotalSup,
	   NULL QtdeProdSup,
	   0 ValorTotalPapel,
	   0 QtdeProdPapel,
	   NULL OS,
	   TB01001_NOME Item,
	   NULL RefItem,
	   NULL ValorItem,
	   TB01006_NOME Vendedor,
	   0 ValorEstimado,
	   0 QtdeContratada,
	   0 QtdeContratadaCALC,
	   0 QtdeAtual,
	   'Serviços' Grupo,
	   NULL Subgrupo,
	   NULL Marca,
	   'Cta. Pagar Contratos' Tipo,
	   NULL Custo,
	   NULL ValorPIS,
	   NULL ValorCofins,
	   NULL ValorIR,
	   NULL ValorCSLL,
	   NULL ValorImpostosDB,
	   TB04014_NTFISC NotaServico,
	   0 ValorISS,
	   NULL Recibo,
	   0 RecebidoRecebido,
	   0 RecebidoPedido,
	   0 ValorDesconto,
	   0 ValorRetenção,
	   NULL DataInstalação,
	   NULL Cidade,
	   NULL Estado,
	   TB04014_CODIGO Registro,
	   NULL EquipamentosTeste,
	   0 Rendimento,
	   NULL Técnico,
	   NULL SLA,
	   NULL Reincidência,
	   NULL DataIni,
	   NULL HoraIni,
	   NULL DataFim,
	   NULL HoraFim,
	   0 CustoPeca,
	   NULL ReqAnterior,
	   0 VidaUtilAnterior,
	   0 MedidorAtual,
	   0 MedidorAnterior,
	   NULL TipoSuprimento,
	   0 ValorFreteReq,
	   TB04014_VLRPAGO ValorServicos,
	   0 Receita,
	  GRUPO10.TB01107_NOME GrupoEco
  FROM VW04008
LEFT JOIN TB02111 ON TB02111_CODIGO = TB04014_CONTRATO
LEFT JOIN TB01007 ON TB01007_CODIGO = TB04014_CODEMP
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02111_CODCLI
LEFT JOIN TB01107 AS GRUPO10 ON GRUPO10.TB01107_CODIGO = TB01008_GRUPO
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02111_VEND
 WHERE TB04014_CONTRATO IS NOT NULL
   AND TB04014_CONTRATO <> ''
   AND TB04015_DTBAIXA IS NOT NULL
   AND TB04014_VLRPAGO > 0
   AND TB04014_OPERACAO NOT IN (3, 4)

GO

